# 主要逻辑分析
介绍机票流程的主要逻辑

## 首页
首页分为机票首页和个人中心两个页面
* 机票首页包括轮播图、城市选择、日期选择、搜索、优惠券、精选航线展示等功能
* 个人中心包括优惠券、积分以及功能导航选项

### 轮播图

展示规则：根据字段status，若值为1则展示轮播图

跳转规则：根据字段activityname，若值可被'-'分割且【1】为inside则项目内跳转 否则直接跳转外部

```javascript
function loadBannerLink(name, url){
  const temp = name.split('-')
  const flag = temp.length > 1 ? (temp[1] == 'inside' ? true : false) : false
  if(flag){
  	this.$router.push(url)
  }else{
  	window.location.href = url
  }
}
```

### 起始城市

展示规则：若没有缓存，则展示定位的当前城市

### 日期

进入选择日期页面时先请求低价日历接口获取，以便页面展示

### 搜索

* 起始城市非空判断
* 增加搜索历史记录
* 查询历史搜索列表接口

### 优惠券

* 配置显示
* 优惠券展示类型
  1. 新人券 couponType === 5
  2. 限时券 couponType === 4
  3. 其他券

### 个人中心

* 积分和优惠券配置展示
* 功能导航栏。
  **值机选座、问题反馈跳转H5-common项目**

## 查询列表

列表页主要包含以下几个功能

* 日期tab
* 列表展示
* 数据筛选以及排序
* 改签
* 页面缓存

### 日期tab

展示距离当前选择日期往后4天的日期选择 

* 点击日期tab 重新请求数据
* 选择低价日历进入日期选择页面 返回则刷新日期tab并请求数据

### 疫情提醒通知

根据列表返回的字段（**tips**）决定是否展示疫情通知相关信息

### 列表信息展示

* 经停  stops > 0

* 跨天数  计算到达时间和起飞时间的时间差

* 票数展示 saleSeats === ‘A’ 票量充足

* 航司icon `https://yunji-flight.oss-cn-shenzhen.aliyuncs.com/images/airlineIcon/${compImg}`

* 舱等信息展示 

  * minDiscount 折扣 

  * isHasBOrFCabin 头等舱/商务舱

  * isHasEconomyCabin 经济舱

    若minDiscount >= 10 则展示经济舱或者头等舱/商务舱全家，否则则按minDiscount展示对应的折扣

### 筛选

筛选数据来源

* 起飞时间 24h  
* 航司 acCompMap
* 舱等  经济舱 头等舱/商务舱
* 起飞机场 depAirportCompMap
* 到达机场 arrAirportCompMap

### 改签

根据订单详情跳转传参判断是否是改签查询 

### 缓存

首页 => 列表 => 详情  => 列表 缓存页面

列表 => 首页 清除缓存 clearCache
